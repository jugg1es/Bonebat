//var gameTime = 0;
//var loopInterval;
function GameplayEngine(stage) {
    this.stage = stage;
    this.gameTime = 0;
    this.loopInterval;
   
    this.buttonLayer = new Kinetic.Layer();
    this.combatLayer = new Kinetic.Layer();
    this.bgLayer = new Kinetic.Layer();
    
}
GameplayEngine.prototype.clearGameplay = function()
{
    this.gameTime =0;
    clearInterval(this.loopInterval);
    this.buttonLayer.remove();
    this.combatLayer.remove();
    this.bgLayer.remove();
};

GameplayEngine.prototype.ShowGameplay = function(human)
{
   this.stage.add(this.bgLayer);
   this.stage.add(this.combatLayer);
   this.stage.add(this.buttonLayer);
   
   
    this.initializeBackground();
    this.initializeButtons();
    
    
    this.monster = new CharacterBase('Chicken', false, '');
    this.human = human;   
    
    
    this.initializeCombatants();
   this.loopInterval =setInterval(this.gameLoop.bind(this),100);
    
   this.stage.draw();
};
GameplayEngine.prototype.gameLoop = function()
{
    this.gameTime += 0.1;
    this.human.evaluate();
    this.monster.evaluate();
    
    
};
GameplayEngine.prototype.initializeCombatants = function()
{
     var bat = new Kinetic.Path({
        x: 100,
        y: 100,
        data: 'M61.102428,50.796608c-0.208023,-3.73584 -0.675903,-10.164566 -5.845993,-7.063736c-2.392487,0.930435 -9.575882,3.294739 -6.102631,-1.591614c-1.903717,-4.868271 -9.649963,2.378342 -10.183136,-1.004807c4.166382,-4.670319 -2.008278,-9.801817 -6.372337,-6.491028c-2.685392,0.771698 -8.160063,5.662048 -9.23168,4.110657c2.494095,-3.299774 8.111992,-10.056044 1.336166,-12.081724c-7.363106,-1.743332 -13.832703,3.549957 -20.235527,6.438749c-1.921402,1.565506 -4.367005,1.293198 -1.976975,-1.314253c8.292076,-13.436211 21.306298,-23.551537 35.746405,-28.692109c3.50032,-1.187668 8.889816,-3.817238 8.995422,2.181427c2.164444,5.521378 3.704407,12.424363 9.278229,15.264939c6.419464,3.725792 1.817825,-10.756393 8.468357,-5.285255c2.798935,1.895058 8.787994,-1.718208 9.609009,0.312491c-1.630783,2.435639 -2.396042,6.7613 1.912674,4.537683c7.482361,-3.072685 12.978149,-9.956573 16.66246,-17.200181c3.848633,-0.603889 7.675232,2.439659 11.184418,4.055374c11.653641,6.888916 18.84462,19.907113 21.89888,33.177512c-3.171738,-1.861893 -6.246536,-5.624863 -10.089767,-7.104935c-4.097458,-2.137205 -8.718811,-2.514006 -13.222824,-2.367323c-2.110855,2.626554 -3.357483,5.887129 -1.522659,9.15074c1.597214,6.250839 -5.095657,-2.151291 -7.512131,-2.722015c-4.511871,-3.368088 -8.834457,1.719223 -7.844513,6.499054c-1.020264,0.921387 -4.167023,-1.544357 -6.015869,-1.258011c-3.8013,-1.195724 -6.478729,0.526505 -4.188721,4.654236c-3.353104,-0.427017 -8.251236,-5.824844 -11.21669,-0.742554c-1.292805,1.269073 -1.958897,3.799149 -3.530552,4.536682z',
       fill: '#000',
        stroke: '#000000',
        strokeWidth: 4
      });
      var chicken = new Kinetic.Path({
        x: 400,
        y: 100,
        data: 'm47.682129,127.558159c-1.120407,-3.400307 -21.386034,0.850761 -10.781261,-3.553413c4.108456,-0.950005 12.543865,0.24115 4.15715,-2.327477c9.550529,3.222275 13.783173,-8.069191 14.399776,-15.681648c-8.889465,-2.76973 -10.428909,-13.114761 -19.796906,-15.900772c-7.137396,-5.595428 -17.601107,-5.424377 -22.131554,-14.05159c-4.301157,-7.682022 -1.871801,-17.03289 -1.159904,-25.331226c1.695013,-8.760502 5.136118,-17.62735 4.455641,-26.529268c-6.937414,3.994017 -9.473597,-4.934599 -9.63195,-7.723469c-5.106329,1.305815 -8.341057,1.363668 -2.788177,-3.178681c2.481544,-3.441122 3.713051,-10.957431 7.677206,-9.829174c1.045994,-4.549839 3.821619,2.068587 6.890604,-1.951439c1.880596,1.419923 5.857853,3.002747 1.449211,5.506271c7.960434,4.016728 14.406267,10.127872 17.722643,17.9373c3.323112,7.936987 9.94389,16.514296 20.635155,14.3668c9.68087,1.662113 21.022675,-4.146938 20.581932,-13.894108c0.187675,-6.905907 6.984825,-23.034113 16.145798,-14.836894c6.865173,2.632715 14.764885,9.154029 13.145233,16.554664c-0.93795,7.630558 -0.213249,15.327133 0.677147,23.019821c-5.749947,4.262173 -4.717773,11.665771 -8.733261,17.240479c3.33123,7.849472 0.123123,16.329407 -5.329926,22.704056c-5.45446,5.87558 -13.426819,11.093857 -22.26284,10.33065c-3.375908,5.619743 3.985992,10.56427 6.58313,10.879089c-6.768105,-2.169487 -5.814713,1.990616 -3.583275,6.435844c2.090714,8.322418 -4.472603,-7.41433 -8.711952,0.115173c-3.287201,3.250633 -16.429504,4.351059 -5.789436,0.45475c9.080261,-3.368538 -10.196724,-5.474937 -5.917709,2.116234c1.416023,3.167053 9.626999,4.561478 0.984196,3.354828c-3.816189,-2.005905 -5.857388,5.116638 -8.886669,3.773201zm18.215736,-14.638016c3.322533,-4.043686 4.278641,-15.742615 -2.90704,-7.213364c-5.679478,4.603027 -7.732876,12.525513 2.90704,7.213364z',
        fill: 'red',
        stroke: '#000000',
        strokeWidth: 4
      });
    
    
    
     this.combatLayer.add(chicken);
     this.combatLayer.add(bat);
};


GameplayEngine.prototype.initializeBackground= function()
{
    var border = new Kinetic.Rect({
          x: 0,
        y: 0,
        width: this.stage.getWidth(),
        height: this.stage.getHeight(),
        stroke: '#000000',
        strokeWidth: 2
       
      });
   
     this.bgLayer.add(border);
    
};

GameplayEngine.prototype.initializeButtons = function()
{
    this.backButton = new Kinetic.Rect({
        name: 'store',
          x: 3,
        y: 3,
        width: 100,
        height: 40,
        stroke: '#000000',
        strokeWidth: 4
       
      });
   this.backButton.on('click', this.locationSelected);
   
     this.buttonLayer.add(this.backButton);
    
};

GameplayEngine.prototype.locationSelected = function()
{
    $(document).trigger('gameEngineQuit'); 
    
};
